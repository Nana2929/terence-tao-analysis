\section{Consequences of the fundamental theorems}\label{sec 11.10}

\begin{proposition}[Integration by parts formula]\label{11.10.1}
    Let \(I = [a, b]\), and let \(F : [a, b] \to \mathbf{R}\) and \(G : [a, b] \to \mathbf{R}\) be differentiable functions on \([a, b]\) such that \(F'\) and \(G'\) are Riemann integrable on \(I\).
    Then we have
    \[
        \int_{[a, b]} F G' = F(b) G(b) - F(a) G(a) - \int_{[a, b]} F' G.
    \]
\end{proposition}

\begin{proof}
    Since \(F\) is an antiderivative of \(F'\) and \(F'\) is Riemann integrable on \([a, b]\), by Theorem \ref{11.9.1} we know that \(F\) is continuous on \([a, b]\).
    Similarly \(G\) is continuous on \([a, b]\).
    By Corollarly \ref{11.5.2} we know that \(F\) and \(G\) are Riemann integrable on \([a, b]\).
    By Theorem \ref{11.4.5} we know that \(F G'\) and \(F' G\) are Riemann integrable on \([a, b]\).
    By Theorem \ref{10.1.13}(d) we have \((FG)' = F' G + F G'\).
    Thus by Theorem \ref{11.4.1}(a) \((FG)'\) is Riemann integrable on \([a, b]\) and
    \begin{align*}
        \int_{[a, b]} (F G') & = \int_{[a, b]} ((FG)' - F' G)                                                        \\
                             & = \int_{[a, b]} ((FG)') - \int_{[a, b]} (F' G)  & \text{(by Theorem \ref{11.4.1}(c))} \\
                             & = F(b) G(b) - F(a) G(a) - \int_{[a, b]} (F' G). & \text{(by Theorem \ref{11.9.4})}
    \end{align*}
\end{proof}

\begin{theorem}\label{11.10.2}
    Let \(\alpha : [a, b] \to \mathbf{R}\) be a monotone increasing function, and suppose that \(\alpha\) is also differentiable on \([a, b]\), with \(\alpha'\) being Riemann integrable.
    Let \(f : [a, b] \to \mathbf{R}\) be a piecewise constant function on \([a, b]\).
    Then \(f \alpha'\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} f \; d \alpha = \int_{[a, b]} f \alpha'.
    \]
\end{theorem}

\begin{proof}
    Since \(f\) is piecewise constant, it is Riemann integrable, and since \(\alpha'\) is also Riemann integrable, then \(f \alpha'\) is Riemann integrable by Theorem \ref{11.4.5}.

    Suppose that \(f\) is piecewise constant with respect to some partition \(\mathbf{P}\) of \([a, b]\);
    without loss of generality we may assume that \(\mathbf{P}\) does not contain the empty set.
    Then we have
    \[
        \int_{[a, b]} f \; d \alpha = p.c. \int_{[\mathbf{P}]} f \; d \alpha = \sum_{J \in \mathbf{P}} c_J \alpha[J]
    \]
    where \(c_J\) is the constant value of \(f\) on \(J\).
    On the other hand, from Theorem \ref{11.4.1}(h) (and Exercise \ref{ex 11.4.3}) we have
    \[
        \int_{[a, b]} f \alpha' = \sum_{J \in \mathbf{P}} \int_J f \alpha' = \sum_{J \in \mathbf{P}} \int_J c_J \alpha' = \sum_{J \in \mathbf{P}} c_J \int_J \alpha'.
    \]
    But by the second fundamental theorem of calculus (Theorem \ref{11.9.4}), \(\int_J \alpha' = \alpha[J]\), and the claim follows.
\end{proof}

\begin{corollary}\label{11.10.3}
    Let \(\alpha : [a, b] \to \mathbf{R}\) be a monotone increasing function, and suppose that \(\alpha\) is also differentiable on \([a, b]\), with \(\alpha'\) being Riemann integrable.
    Let \(f : [a, b] \to \mathbf{R}\) be a function which is Riemann-Stieltjes integrable with respect to \(\alpha\) on \([a, b]\).
    Then \(f \alpha'\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} f \; d \alpha = \int_{[a, b]} f \alpha'.
    \]
\end{corollary}

\begin{proof}
    Note that since \(f\) and \(\alpha'\) are bounded, then \(f \alpha'\) must also be bounded.
    Also, since \(\alpha\) is monotone increasing and differentable, \(\alpha'\) is non-negative (by Proposition \ref{10.3.1}).

    Let \(\varepsilon > 0\).
    Then, we can find a piecewise constant function \(\overline{f}\) majorizing \(f\) on \([a, b]\), and a piecewise constant function \(\underline{f}\) minorizing \(f\) on \([a, b]\), such that
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \int_{[a, b]} \underline{f} \; d \alpha \leq \int_{[a, b]} \overline{f} \; d \alpha \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]
    Applying Theorem \ref{11.10.2}, we obtain
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \int_{[a, b]} \underline{f} \alpha' \leq \int_{[a, b]} \overline{f} \alpha' \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]

    Since \(\alpha'\) is non-negative and \(\underline{f}\) minorizes \(f\), then \(\underline{f} \alpha'\) minorizes \(f \alpha'\).
    Thus \(\int_{[a, b]} \underline{f} \alpha' \leq \underline{\int}_{[a, b]} f \alpha'\).
    Thus
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \underline{\int}_{[a, b]} f \alpha'.
    \]
    Similarly we have
    \[
        \overline{\int}_{[a, b]} f \alpha' \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]
    Since these statements are true for any \(\varepsilon > 0\), we must have
    \[
        \int_{[a, b]} f \; d \alpha \leq \underline{\int}_{[a, b]} f \alpha' \leq \overline{\int}_{[a, b]} f \alpha' \leq \int_{[a, b]} f \; d \alpha
    \]
    and the claim follows.
\end{proof}

\begin{remark}\label{11.10.4}
    Informally, Corollary \ref{11.10.3} asserts that \(f \; d \alpha\) is essentially equivalent to \(f \frac{d \alpha}{dx} dx\), when \(\alpha\) is differentiable.
    However, the advantage of the Riemann-Stieltjes integral is that it still makes sense even when \(\alpha\) is not differentiable.
\end{remark}

\begin{lemma}[Change of variables formula I]\label{11.10.5}
    Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to [\phi(a), \phi(b)]\) be a continuous monotone increasing function.
    Let \(f : [\phi(a), \phi(b)] \to \mathbf{R}\) be a piecewise constant function on \([\phi(a), \phi(b)]\).
    Then \(f \circ \phi : [a, b] \to \mathbf{R}\) is also piecewise constant on \([a, b]\), and
    \[
        \int_{[a, b]} f \circ \phi \; d \phi = \int_{[\phi(a), \phi(b)]} f.
    \]
\end{lemma}

\begin{proof}
    Let \(\mathbf{P}\) be a partition of \([\phi(a), \phi(b)]\) such that \(f\) is piecewise constant with respect to \(\mathbf{P}\);
    we may assume that \(\mathbf{P}\) does not contain the empty set.
    For each \(J \in \mathbf{P}\), let \(c_J\) be the constant value of \(f\) on \(J\), thus
    \[
        \int_{[\phi(a), \phi(b)]} f = \sum_{J \in \mathbf{P}} c_J \abs*{J}.
    \]
    For each interval \(J\), let \(\phi^{-1}(J)\) be the set \(\phi^{-1}(J) \coloneqq \{x \in [a, b] : \phi(x) \in J\}\).
    Then \(\phi^{-1}(J)\) is connected (by Proposition \ref{9.8.3} and Lemma \ref{11.1.4}), and is thus an interval.
    Furthermore, \(c_J\) is the constant value of \(f \circ \phi\) on \(\phi^{-1}(J)\) (since \((f \circ \phi)(\phi^{-1}(J)) = f(J)\)).
    Thus, if we define \(\mathbf{S} \coloneqq \{\phi^{-1} (J) : J \in \mathbf{P}\}\), then \(\mathbf{S}\) partitions \([a, b]\)
    (\(\mathbf{S}\) is finite since \(\mathbf{P}\) is finite;
    \(\phi^{-1}(J)\) is an interval and \(\phi\) is a bijection from \([a, b]\) to \([\phi(a), \phi(b)]\)),
    and \(f \circ \phi\) is piecewise constant with respect to \(\mathbf{S}\) (for every \(\phi^{-1}(J) \in \mathbf{S}\), \(f\) is constant on \(\phi^{-1}(J)\)).
    Thus
    \[
        \int_{[a, b]} f \circ \phi \; d \phi = \int_{[\mathbf{S}]} f \circ \phi \; d \phi = \sum_{J \in \mathbf{P}} c_J \phi[\phi^{-1}(J)].
    \]
    But \(\phi[\phi^{-1}(J)] = \abs*{J}\) (since \(\phi(\phi^{-1}(J)) = J\)), and the claim follows.
\end{proof}