\section{Piecewise constant functions}\label{sec 11.2}

\begin{definition}[Constant functions]\label{11.2.1}
    Let \(X\) be a subset of \(\mathbf{R}\), and let \(f : X \to \mathbf{R}\) be a function.
    We say that \(f\) is \emph{constant} iff there exists a real number \(c\) such that \(f(x) = c\) for all \(x \in X\).
    If \(E\) is a subset of \(X\), we say that \(f\) is \emph{constant on} \(E\) if the restriction \(f|_E\) of \(f\) to \(E\) is constant, in other words there exists a real number \(c\) such that \(f(x) = c\) for all \(x \in E\).
    We refer to \(c\) as the \emph{constant value} of \(f\) on \(E\).
\end{definition}

\begin{remark}\label{11.2.2}
    If \(E\) is a non-empty set, then a function \(f\) which is constant on \(E\) can have only one constant value;
    However, if \(E\) is empty, every real number \(c\) is a constant value for \(f\) on \(E\).
\end{remark}

\begin{definition}[Piecewise constant functions I]\label{11.2.3}
    Let \(I\) be a bounded interval, let \(f : I \to \mathbf{R}\) be a function, and let \(\mathbf{P}\) be a partition of \(I\).
    We say that \(f\) is \emph{piecewise constant with respect to \(\mathbf{P}\)} if for every \(J \in \mathbf{P}\), \(f\) is constant on \(J\).
\end{definition}

\setcounter{theorem}{4}
\begin{definition}[Piecewise constant functions II]\label{11.2.5}
    Let \(I\) be a bounded interval, and let \(f : I \to \mathbf{R}\) be a function.
    We say that \(f\) is \emph{piecewise constant on \(I\)} if there exists a partition \(\mathbf{P}\) of \(I\) such that \(f\) is piecewise constant with respect to \(\mathbf{P}\).
\end{definition}

\setcounter{theorem}{6}
\begin{lemma}\label{11.2.7}
    Let \(I\) be a bounded interval, let \(\mathbf{P}\) be a partition of \(I\), and let \(f : I \to \mathbf{R}\) be a function which is piecewise constant with respect to \(\mathbf{P}\).
    Let \(\mathbf{P}'\) be a partition of \(I\) which is finer than \(\mathbf{P}\).
    Then \(f\) is also piecewise constant with respect to \(\mathbf{P}'\).
\end{lemma}

\begin{proof}
    Let \(K \in \mathbf{P}'\).
    Since \(\mathbf{P}'\) is finer than \(\mathbf{P}\), by Definition \ref{11.1.14} \(\exists\ J \in \mathbf{P}\) such that \(K \subseteq J\).
    Since \(f\) is piecewise constant with respect to \(\mathbf{P}\), by Definition \ref{11.2.3} we know that \(\forall\ x \in J\), \(f(x)\) is constant.
    Thus \(\forall\ x \in K\), \(x \in J\) and \(f(x)\) is constant.
    By Definition \ref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}'\).
\end{proof}

\begin{lemma}\label{11.2.8}
    Let \(I\) be a bounded interval, and let \(f : I \to \mathbf{R}\) and \(g : I \to \mathbf{R}\) be piecewise constant functions on \(I\).
    Then the functions \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\) and \(fg\) are also piecewise constant functions on \(I\).
    Here of course \(\max(f, g) : I \to \mathbf{R}\) is the function \(\max(f, g)(x) \coloneqq \max(f(x), g(x))\).
    If \(g\) does not vanish anywhere on \(I\) (i.e., \(g(x) \neq 0\) for all \(x \in I\)) then \(f / g\) is also a piecewise constant function on \(I\).
\end{lemma}

\begin{proof}
    Since \(f\) is piecewise constant function on \(I\), by Definition \ref{11.2.5} \(\exists\ \mathbf{P}\) such that \(\mathbf{P}\) is a partition of \(I\) and \(f\) is piecewise constant with respect to \(\mathbf{P}\).
    Similarly since \(g\) is piecewise constant function on \(I\), by Definition \ref{11.2.5} \(\exists\ \mathbf{P}'\) such that \(\mathbf{P}'\) is a partition of \(I\) and \(g\) is piecewise constant with respect to \(\mathbf{P}'\).
    By Lemma \ref{11.1.18} we know that \(\mathbf{P} \# \mathbf{P}'\) is also a partition of \(I\) and \(\mathbf{P} \# \mathbf{P}'\) is both finer than \(\mathbf{P}\) and finer than \(\mathbf{P}'\).
    By Lemma \ref{11.2.7} we know that both \(f\) and \(g\) are piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).

    Now we show that \(f, g\) remain piecewise constant functions on \(I\) after algebraic operation.
    Since \(\forall\ J \in \mathbf{P} \# \mathbf{P}'\), we have \(\forall\ x \in J\), \(f(x)\) is constant and \(g(x)\) is constant.
    Thus we know that \(f(x) + g(x)\), \(f(x) - g(x)\), \(\max(f(x), g(x))\), \(\min(f(x), g(x))\) and \(f(x) g(x)\) are constant.
    If \(g(x) \neq 0\), then we also have \(f(x) / g(x)\) is constant.
    Thus by Definition \ref{11.2.3} \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\), \(fg\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\), and when \(g(x) \neq 0\) we have \(f / g\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).
    By Definition \ref{11.2.5} \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\), \(fg\) is piecewise constant on \(I\), and when \(g(x) \neq 0\) we have \(f / g\) is piecewise constant on \(I\).
\end{proof}

\begin{definition}[Piecewise constant integral I]\label{11.2.9}
    Let \(I\) be a bounded interval, let \(\mathbf{P}\) be a partition of \(I\).
    Let \(f : I \to \mathbf{R}\) be a function which is piecewise constant with respect to \(\mathbf{P}\).
    Then we define the \emph{piecewise constant integral} \(p.c. \int_{[\mathbf{P}]} f\) of \(f\) with respect to the partition \(\mathbf{P}\) by the formula
    \[
        p.c. \int_{[\mathbf{P}]} f \coloneqq \sum_{J \in \mathbf{P}} c_J \abs*{J},
    \]
    where for each \(J\) in \(\mathbf{P}\), we let \(c_J\) be the constant value of \(f\) on \(J\).
\end{definition}

\begin{remark}\label{11.2.10}
    This definition seems like it could be ill-defined, because if \(J\) is empty then every number \(c_J\) can be the constant value of \(f\) on \(J\), but fortunately in such cases \(\abs*{J}\) is zero and so the choice of \(c_J\) is irrelevant.
    The notation \(p.c. \int_{[\mathbf{P}]} f\) is rather artificial, but we shall only need it temporarily, en route to a more useful definition.
    Note that since \(\mathbf{P}\) is finite, the sum \(\sum_{J \in \mathbf{P}} c_J \abs*{J}\) is always well-defined
    (it is never divergent or infinite).
\end{remark}

\begin{remark}\label{11.2.11}
    The piecewise constant integral corresponds intuitively to one's notion of area, given that the area of a rectangle ought to be the product of the lengths of the sides.
    (Of course, if \(f\) is negative somewhere, then the ``area'' \(c_J \abs*{J}\) would also be negative.)
\end{remark}

\setcounter{theorem}{12}
\begin{proposition}[Piecewise constant integral is independent of partition]\label{11.2.13}
    Let \(I\) be a bounded interval, and let \(f : I \to \mathbf{R}\) be a function.
    Suppose that \(\mathbf{P}\) and \(\mathbf{P}'\) are partitions of \(I\) such that \(f\) is piecewise constant both with respect to \(\mathbf{P}\) and with respect to \(\mathbf{P}'\).
    Then \(p.c. \int_{[\mathbf{P}]} f = p.c. \int_{[\mathbf{P}']} f\).
\end{proposition}

\begin{proof}
    By Definition \ref{11.2.9} we have
    \[
        p.c. \int_{[\mathbf{P}]} f = \sum_{J \in \mathbf{P}} c_J \abs*{J}
    \]
    and
    \[
        p.c. \int_{[\mathbf{P}']} f = \sum_{J \in \mathbf{P}'} c_J \abs*{J}.
    \]
    By Lemma \ref{11.1.18} we know that \(\mathbf{P} \# \mathbf{P}'\) is a partition of \(I\) and is both finer than \(\mathbf{P}\) and finer than \(\mathbf{P}'\), thus by Definition \ref{11.2.9}
    \[
        p.c. \int_{[\mathbf{P} \# \mathbf{P}']} f = \sum_{J \in \mathbf{P} \# \mathbf{P}'} c_J \abs*{J}.
    \]
    To show that \(p.c. \int_{[\mathbf{P}]} f = p.c. \int_{[\mathbf{P}']} f\), it suffices to show that
    \[
        \sum_{J \in \mathbf{P}} c_J \abs*{J} = \sum_{J \in \mathbf{P}'} c_J \abs*{J} = \sum_{J \in \mathbf{P} \# \mathbf{P}'} c_J \abs*{J}.
    \]
    By Theorem \ref{11.1.13}, we know that
    \[
        \abs*{I} = \sum_{J \in \mathbf{P}} \abs*{J} = \sum_{J \in \mathbf{P} \# \mathbf{P}'} \abs*{J}.
    \]
    By Definition \ref{11.1.14}, \(\forall\ S \in \mathbf{P} \# \mathbf{P}'\), \(\exists\ K \in \mathbf{P}\) such that \(S \subseteq K\).
    Now we fix such \(K\) and let \(\mathbf{P}_K\) be the set
    \[
        \mathbf{P}_K = \{S \in \mathbf{P} \# \mathbf{P}' : S \subseteq K\}.
    \]
    We claim that \(\mathbf{P}_K\) is a partition of \(K\).
    We know that \(\mathbf{P}_K\) is finite since \(\mathbf{P}_K \subseteq \mathbf{P} \# \mathbf{P}'\) and \(\mathbf{P} \# \mathbf{P}'\) is finite.
    Since \(\mathbf{P} \# \mathbf{P}'\) is a partition of \(I\), by Definition \ref{11.1.10} \(\forall\ S \in \mathbf{P}_K\), \(S\) is a bounded interval, and if \(S' \in \mathbf{P}_K\) and \(S \neq S'\) then \(S \cap S' = \emptyset\).
    Let \(x \in K\).
    By Definition \ref{11.1.10} we must have \(x \in I\), and \(\exists!\ K' \in \mathbf{P}'\) such that \(x \in K'\).
    By Definition \ref{11.1.16} we know that \(K \cap K' \in \mathbf{P} \# \mathbf{P}'\).
    Since \(K \cap K' \subseteq K\), we have \(x \in \bigcup \mathbf{P}_K\), so \(K \subseteq \bigcup \mathbf{P}_K\).
    By the definition of \(\mathbf{P}_K\) we know that \(\bigcup \mathbf{P}_K \subseteq K\), thus by Proposition \ref{3.1.18} we have \(K = \bigcup \mathbf{P}_K\) and by Definition \ref{11.1.10} \(\mathbf{P}_K\) is a partition of \(K\).

    Since \(f\) is piecewise constant with respect to \(\mathbf{P}\), by Lemma \ref{11.2.7} we know that \(f\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).
    So we have
    \begin{align*}
        & \forall\ J \in \mathbf{P}, J = \bigcup \mathbf{P}_J \\
        \implies & \abs*{J} = \sum_{J' \in \mathbf{P}_J} \abs*{J'} & \text{(by Theorem \ref{11.1.13})} \\
        \implies & \abs*{I} = \sum_{J \in \mathbf{P}} \abs*{J} = \sum_{J \in \mathbf{P}} \sum_{J' \in \mathbf{P}_J} \abs*{J'} = \sum_{J \in \mathbf{P} \# \mathbf{P}'} \abs*{J} \\
        \implies & p.c. \int_{[\mathbf{P}]} f = \sum_{J \in \mathbf{P}} c_J \abs*{J} = \sum_{J \in \mathbf{P}} c_J \bigg(\sum_{J' \in \mathbf{P}_J} \abs*{J'}\bigg) & \text{(by Definition \ref{11.2.9})} \\
        \implies & p.c. \int_{[\mathbf{P}]} f = \sum_{J \in \mathbf{P} \# \mathbf{P}'} c_J \abs*{J}.
    \end{align*}
\end{proof}