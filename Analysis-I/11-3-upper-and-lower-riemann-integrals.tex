\section{Upper and lower Riemann integrals}\label{sec 11.3}

\begin{definition}[Majorization of functions]\label{11.3.1}
    Let \(f : I \to \mathbf{R}\) and \(g : I \to \mathbf{R}\).
    We say that \(g\) \emph{majorizes} \(f\) on \(I\) if we have \(g(x) \geq f(x)\) for all \(x \in I\), and that \(g\) \emph{minorizes} \(f\) on \(I\) if \(g(x) \leq f(x)\) for all \(x \in I\).
\end{definition}

\begin{definition}[Upper and lower Riemann integrals]\label{11.3.2}
    Let \(f : I \to \mathbf{R}\) be a bounded function defined on a bounded interval \(I\).
    We define the \emph{upper Riemann integral} \(\overline{\int}_I f\) by the formula
    \[
        \overline{\int}_I f \coloneqq \inf\{p.c. \int_I g : g \text{ is a piecewise constant function on \(I\) which majorizes } f\}
    \]
    and the \emph{lower Riemann integral} \(\underline{\int}_I f\) by the formula
    \[
        \underline{\int}_I f \coloneqq \sup\{p.c. \int_I g : g \text{ is a piecewise constant function on \(I\) which minorizes } f\}.
    \]
\end{definition}

\begin{lemma}\label{11.3.3}
    Let \(f : I \to \mathbf{R}\) be a function on a bounded interval \(I\) which is bounded by some real number \(M\), i.e., \(-M \leq f(x) \leq M\) for all \(x \in I\).
    Then we have
    \[
        -M \abs*{I} \leq \underline{\int}_I f \leq \overline{\int}_I f \leq M \abs*{I}.
    \]
    in particular, both the lower and upper Riemann integrals are real numbers (i.e., they are not infinite).
\end{lemma}

\begin{proof}
    The function \(g : I \to \mathbf{R}\) defined by \(g(x) = M\) is constant, hence piecewise constant, and majorizes \(f\);
    thus \(\overline{\int}_I f \leq p.c. \int_I g = M \abs*{I}\) by definition of the upper Riemann integral.
    A similar argument gives \(-M \abs*{I} \leq \underline{\int}_I f\).
    Finally, we have to show that \(\underline{\int}_I f \leq \overline{\int}_I f\).
    Let \(g\) be any piecewise constant function majorizing \(f\), and let \(h\) be any piecewise constant function minorizing \(f\).
    Then \(g\) majorizes \(h\), and hence \(p.c. \int_I h \leq p.c. \int_I g\).
    Taking suprema in \(h\), we obtain that \(\underline{\int}_I f \leq p.c. \int_I g\).
    Taking infima in \(g\), we thus obtain \(\underline{\int}_I f \leq \overline{\int}_I f\), as desired.
\end{proof}

\begin{definition}[Riemann integral]\label{11.3.4}
    Let \(f : I \to \mathbf{R}\) be a bounded function on a bounded interval \(I\).
    If \(\underline{\int}_I f = \overline{\int}_I f\), then we say that \(f\) is \emph{Riemann integrable on \(I\)} and define
    \[
        \int_I f \coloneqq \underline{\int}_I f = \overline{\int}_I f.
    \]
    If the upper and lower Riemann integrals are unequal, we say that \(f\) is not Riemann integrable.
\end{definition}

\begin{remark}\label{11.3.5}
    Compare this definition to the relationship between the \(\limsup\), \(liminf\), and limit of a sequence \(a_n\) that was established in Proposition \ref{6.4.12}(f);
    the \(\limsup\) is always greater than or equal to the \(\liminf\), but they are only equal when the sequence converges, and in this case they are both equal to the limit of the sequence.
    The definition given above may differ from the definition you may have encountered in your calculus courses, based on Riemann sums.
    However, the two definitions turn out to be equivalent.
\end{remark}

\begin{remark}\label{11.3.6}
    Note that we do not consider unbounded functions to be Riemann integrable;
    an integral involving such functions is known as an \emph{improper integral}.
    It is possible to still evaluate such integrals using more sophisticated integration methods (such as the Lebesgue integral).
\end{remark}

\begin{lemma}\label{11.3.7}
    Let \(f : I \to \mathbf{R}\) be a piecewise constant function on a bounded interval \(I\).
    Then \(f\) is Riemann integrable, and \(\int_I f = p.c. \int_I f\).
\end{lemma}

\begin{proof}
    Since \(f(x) \leq f(x)\), by Definition \ref{11.3.2} we have
    \[
        \overline{\int}_I f \leq p.c. \int_I f
    \]
    and
    \[
        p.c. \int_I f \leq \underline{\int}_I f.
    \]
    By Lemma \ref{11.3.3} we know that
    \[
        p.c. \int_I f \leq \underline{\int}_I f \leq \overline{\int}_I f \leq p.c. \int_I f.
    \]
    Thus by Definition \ref{11.3.4} we have
    \[
        \int_I f = \underline{\int}_I f = \overline{\int}_I f = p.c. \int_I f.
    \]
\end{proof}

\begin{remark}\label{11.3.8}
    Because of this lemma, we will not refer to the piecewise constant integral \(p.c. \int_I\) again, and just use the Riemann integral \(\int_I\) throughout
    (until this integral is itself superceded by the Lebesgue integral).
    We observe one special case of Lemma \ref{11.3.7}:
    if \(I\) is a point or the empty set, then \(\int_I f = 0\) for all functions \(f : I \to \mathbf{R}\).
    (Note that all such functions are automatically constant.)
\end{remark}

\begin{definition}[Riemann sums]\label{11.3.9}
    Let \(f : I \to \mathbf{R}\) be a bounded function on a bounded interval \(I\), and let \(\mathbf{P}\) be a partition of \(I\).
    We define the \emph{upper Riemann sum} \(U(f, \mathbf{P})\) and the \emph{lower Riemann sum} \(L(f, \mathbf{P})\) by
    \[
        U(f, \mathbf{P}) \coloneqq \sum_{J \in \mathbf{P} : J \neq \emptyset} (\sup_{x \in J} f(x)) \abs*{J}
    \]
    and
    \[
        L(f, \mathbf{P}) \coloneqq \sum_{J \in \mathbf{P} : J \neq \emptyset} (\inf_{x \in J} f(x)) \abs*{J}
    \]
\end{definition}

\begin{remark}\label{11.3.10}
    The restriction \(J \neq \emptyset\) is required because the quantities \(\inf_{x \in J} f(x)\) and \(\sup_{x \in J} f(x)\) are infinite (or negative infinite) if \(J\) is empty.
\end{remark}

\begin{lemma}\label{11.3.11}
    Let \(f : I \to \mathbf{R}\) be a bounded function on a bounded interval \(I\), and let \(g\) be a function which majorizes \(f\) and which is piecewise constant with respect to some partition \(\mathbf{P}\) of \(I\).
    Then
    \[
        p.c. \int_I g \geq U(f, \mathbf{P}).
    \]
    Similarly, if \(h\) is a function which minorizes \(f\) and is piecewise constant with respect to \(\mathbf{P}\), then
    \[
        p.c. \int_I h \leq L(f, \mathbf{P}).
    \]
\end{lemma}

\begin{proof}
    Since \(g\) majorizes \(f\) and \(h\) minorizes \(f\), by Definition \ref{11.3.1} we have \(\forall\ x \in I\), \(h(x) \leq f(x) \leq g(x)\).
    Since \(\mathbf{P}\) is a partition of \(I\), by Definition \ref{11.1.10} we have \(\forall\ J \in \mathbf{P}\), \(h(x) \leq f(x) \leq g(x)\) for all \(x \in J\).
    In particular, we have
    \[
        h(x) \leq \inf_{x \in J} f(x) \leq f(x) \leq \sup_{x \in J} f(x) \leq g(x)
    \]
    when \(J \neq \emptyset\).
    Let \(c_{g_J}, c_{h_J}\) be constant values of \(g, h\) on \(J\) respectively.
    Then we have
    \begin{align*}
        U(f, \mathbf{P}) & = \sum_{J \in \mathbf{P} : J \neq \emptyset} (\sup_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & \leq \sum_{J \in \mathbf{P} : J \neq \emptyset} c_{g_J} \abs*{J} & \text{(by Proposition \ref{7.1.11}(h))} \\
        & = \sum_{J \in \mathbf{P}} c_{g_J} \abs*{J} & \text{(by Proposition \ref{7.1.11}(a)(e))} \\
        & = p.c. \int_{[\mathbf{P}]} g & \text{(by Definition \ref{11.2.9})} \\
        & = p.c. \int_I g & \text{(by Definition \ref{11.2.14})}
    \end{align*}
    and
    \begin{align*}
        L(f, \mathbf{P}) & = \sum_{J \in \mathbf{P} : J \neq \emptyset} (\inf_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & \geq \sum_{J \in \mathbf{P} : J \neq \emptyset} c_{h_J} \abs*{J} & \text{(by Proposition \ref{7.1.11}(h))} \\
        & = \sum_{J \in \mathbf{P}} c_{h_J} \abs*{J} & \text{(by Proposition \ref{7.1.11}(a)(e))} \\
        & = p.c. \int_{[\mathbf{P}]} h & \text{(by Definition \ref{11.2.9})} \\
        & = p.c. \int_I h. & \text{(by Definition \ref{11.2.14})}
    \end{align*}
\end{proof}

\begin{proposition}\label{11.3.12}
    Let \(f : I \to \mathbf{R}\) be a bounded function on a bounded interval \(I\).
    Then
    \[
        \overline{\int}_I f = \inf \{U(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\}
    \]
    and
    \[
        \underline{\int}_I f = \sup \{L(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\}
    \]
\end{proposition}

\begin{proof}
    If \(I = \emptyset\), then by Definition \ref{11.1.10} the only partition of \(\emptyset\) is \(\{\emptyset\}\).
    By Definition \ref{11.3.2} we have
    \[
        \overline{\int}_{\emptyset} f = \inf \{0\} = 0 = \sup \{0\} = \underline{\int}_{\emptyset} f.
    \]
    By Definition \ref{11.3.9} we have
    \begin{align*}
        \inf \{U(f, \{\emptyset\})\} & = U(f, \{\emptyset\}) \\
        & = \sum_{J \in \{\emptyset\} : J \neq \emptyset} (\sup_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & = \sum_{J \in \emptyset} (\sup_{x \in J} f(x)) \abs*{J} \\
        & = 0 & \text{(by Proposition \ref{7.1.11}(a))}
    \end{align*}
    and
    \begin{align*}
        \sup \{L(f, \{\emptyset\})\} & = L(f, \{\emptyset\}) \\
        & = \sum_{J \in \{\emptyset\} : J \neq \emptyset} (\inf_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & = \sum_{J \in \emptyset} (\inf_{x \in J} f(x)) \abs*{J} \\
        & = 0. & \text{(by Proposition \ref{7.1.11}(a))}
    \end{align*}
    Thus when \(I = \emptyset\), we have
    \[
        \overline{\int}_{\emptyset} f = \inf \{U(f, \{\emptyset\})\} = \underline{\int}_{\emptyset} f = \sup \{L(f, \{\emptyset\})\} = 0.
    \]

    Now suppose that \(I \neq \emptyset\).
    Let \(g\) be a function which majorizes \(f\) and which is piecewise constant with respect to some partition \(\mathbf{P}_g\) of \(I\).
    Let \(h\) be a function which minorizes \(f\) and which is piecewise constant with respect to some partition \(\mathbf{P}_h\) of \(I\).
    Both function is well defined since \(f\) is bounded function on a bounded interval \(I\).
    If \(\emptyset \in \mathbf{P}_g\), then \(\mathbf{P}_g \setminus \{\emptyset\}\) is also a partition of \(I\), thus we can choose a partition without containing \(\emptyset\).
    In particular, let \(\emptyset \notin \mathbf{P}_g\) and \(\emptyset \notin \mathbf{P}_h\).
    By Lemma \ref{11.3.11} we have \(U(f, \mathbf{P}_g) \leq p.c. \int_I g\) and \(L(f, \mathbf{P}_h) \geq p.c. \int_I h\), thus \(U(f, \mathbf{P})\) is a lower bound of the set
    \[
        \{p.c. \int_I g' : g' \text{ is a piecewise constant function on \(I\) which majorizes } f\}
    \]
    and
    \(L(f, \mathbf{P}_h)\) is an upper bound of the set
    \[
        \{p.c. \int_I h' : h' \text{ is a piecewise constant function on \(I\) which minorizes } f\}.
    \]
    By Definition \ref{11.3.2} we have
    \[
        \inf \{U(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\} \leq U(f, \mathbf{P}_g) \leq \overline{\int}_I f \leq p.c. \int_I g
    \]
    and
    \[
        \sup \{L(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\} \geq L(f, \mathbf{P}_h) \geq \underline{\int}_I f \geq p.c. \int_I h.
    \]
    Let \(G : I \to \mathbf{R}\) be a function where \(G(x) = \sup_{x \in J} f(x)\) for all \(J \in \mathbf{P}_g\).
    Let \(H : I \to \mathbf{R}\) be a function where \(H(x) = \inf_{x \in J} f(x)\) for all \(J \in \mathbf{P}_h\).
    By Definition \ref{11.2.3} we know that \(G\) is a piecewise constant function with respect to \(\mathbf{P}_g\) and \(H\) is a piecewise constant function with respect to \(\mathbf{P}_h\).
    Thus we have
    \begin{align*}
        U(f, \mathbf{P}_g) & = \sum_{J \in \mathbf{P}_g : J \neq \emptyset} (\sup_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & = \sum_{J \in \mathbf{P}_g} (\sup_{x \in J} f(x)) \abs*{J} & (\emptyset \notin \mathbf{P}_g) \\
        & = p.c. \int_{[\mathbf{P}_g]} G & \text{(by Definition \ref{11.2.9})} \\
        & = p.c. \int_I G & \text{(by Definition \ref{11.2.14})}
    \end{align*}
    and
    \begin{align*}
        L(f, \mathbf{P}_h) & = \sum_{J \in \mathbf{P}_h : J \neq \emptyset} (\inf_{x \in J} f(x)) \abs*{J} & \text{(by Definition \ref{11.3.9})} \\
        & = \sum_{J \in \mathbf{P}_h} (\inf_{x \in J} f(x)) \abs*{J} & (\emptyset \notin \mathbf{P}_h) \\
        & = p.c. \int_{[\mathbf{P}_h]} H & \text{(by Definition \ref{11.2.9})} \\
        & = p.c. \int_I H & \text{(by Definition \ref{11.2.14})}
    \end{align*}
    By Definition \ref{11.3.2} we have
    \[
        \overline{\int}_I f \leq p.c. \int_I G = U(f, \mathbf{P}_g)
    \]
    and
    \[
        \underline{\int}_I f \geq p.c. \int_I H = L(f, \mathbf{P}_h).
    \]
    Thus
    \[
        \overline{\int}_I f \leq \inf \{U(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\} \leq U(f, \mathbf{P}_g)
    \]
    and
    \[
        \underline{\int}_I f \geq \sup \{L(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\} \leq L(f, \mathbf{P}_h).
    \]
    Combine all results above we have
    \[
        \overline{\int}_I f = \inf \{U(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\}
    \]
    and
    \[
        \underline{\int}_I f = \sup \{L(f, \mathbf{P}) : \mathbf{P} \text{ is a partition of } I\}.
    \]
\end{proof}