\section{Uniform convergence and derivatives}\label{sec 3.7}

\begin{note}
    In particular we have
    \[
        \frac{d}{dx} \lim_{n \to \infty} f_n(x) \neq \lim_{n \to \infty} \frac{d}{dx} f_n(x)
    \]
    So, in summary, uniform convergence of the functions \(f_n\) says nothing about the convergence of the derivatives \(f_n'\).
\end{note}

\begin{theorem}\label{3.7.1}
    Let \([a, b]\) be an interval, and for every integer \(n \geq 1\), let \(f_n : [a, b] \to \mathbf{R}\) be a differentiable function whose derivative \(f_n' : [a, b] \to \mathbf{R}\) is continuous.
    Suppose that the derivatives \(f_n'\) converge uniformly to a function \(g : [a, b] \to \mathbf{R}\).
    Suppose also that there exists a point \(x_0\) such that the limit \(\lim_{n \to \infty} f_n(x_0)\) exists.
    Then the functions \(f_n\) converge uniformly to a differentiable function \(f\), and the derivative of \(f\) equals \(g\).
\end{theorem}

\begin{proof}
    Since \(f_n'\) is continuous, by Corollary 11.5.2 in Analysis I we know that \(f_n'\) is Riemann integrable.
    We see from the fundamental theorem of calculus (Theorem 11.9.4 in Analysis I) that
    \[
        f_n(x) - f_n(x_0) = \int_{[x_0, x]} f_n'
    \]
    when \(x \in [x_0, b]\), and
    \[
        f_n(x) - f_n(x_0) = -\int_{[x, x_0]} f_n'
    \]
    when \(x \in [a, x_0]\).
    Let \(L\) be the limit of \(f_n(x_0)\) as \(n \to \infty\):
    \[
        L \coloneqq \lim_{n \to \infty} f_n(x_0).
    \]
    By hypothesis, \(L\) exists.
    Now, since each \(f_n'\) is continuous on \([a, b]\), and \(f_n'\) converges uniformly to \(g\), we see by Corollary \ref{3.3.2} that \(g\) is also continuous.
    By Theorem \ref{3.6.1} we have
    \[
        \forall\ x \in [a, b], \lim_{n \to \infty} \big(f_n(x) - f_n(a)\big) = \lim_{n \to \infty} \int_{[a, x]} f_n' = \int_{[a, x]} \big(\lim_{n \to \infty} f_n'\big) = \int_{[a, x]} g.
    \]
    Now define the function \(f : [a, b] \to \mathbf{R}\) by setting
    \[
        f(x) \coloneqq L - \int_{[a, x_0]} g + \int_{[a, x]} g
    \]
    for all \(x \in [a, b]\).
    To finish the proof, we have to show that \(f_n\) converges uniformly to \(f\), and that \(f\) is differentiable with derivative \(g\).

    We know that \(a \neq b\) since if \(a = b\), then we have \(x_0 = a = b\) and
    \[
        \forall\ n \in \mathbf{Z}^+, \lim_{x \to x_0; x \in \{x_0\} \setminus \{x_0\}} \frac{f_n(x) - f_n(x_0)}{x - x_0} \text{ is undefined}
    \]
    which contradict to the hypothesis that \(f_n\) is differentiable on \([a, b]\).
    Observe that
    \begin{align*}
                 & L = \lim_{n \to \infty} f_n(x_0)                                                                                                                \\
        \implies & \forall\ \varepsilon \in \mathbf{R}^+, \exists\ N_1 \in \mathbf{Z}^+ : \forall\ n \geq N_1, \abs*{f_n(x_0) - L} < \frac{\varepsilon}{3(b - a)}.
    \end{align*}
    Now we fix one pair of \(\varepsilon\) and \(N_1\).
    Since \((f_n')_{n = 1}^\infty\) converges uniformly to \(g\) on \([a, b]\) with respect to \(d_{l^1}|_{\mathbf{R} \times \mathbf{R}}\), by Definition \ref{3.2.7} we have
    \begin{align*}
                 & \exists\ N_2 \in \mathbf{Z}^+ : \forall\ n \geq N_2, \forall\ x \in [a, b],                                                     \\
                 & \abs*{f_n'(x) - g(x)} < \frac{\varepsilon}{3(b - a)}                                                                            \\
        \implies & \exists\ N_2 \in \mathbf{Z}^+ : \forall\ n \geq N_2, \forall\ x \in [a, b],                                                     \\
                 & \frac{-\varepsilon}{3(b - a)} < f_n'(x) - g(x) < \frac{\varepsilon}{3(b - a)}                                                   \\
        \implies & \exists\ N_2 \in \mathbf{Z}^+ : \forall\ n \geq N_2, \forall\ x \in [a, b],                                                     \\
                 & \frac{-\varepsilon (x - a)}{3(b - a)} \leq \int_{[a, x]} f_n'(x) - \int_{[a, x]} g(x) \leq \frac{\varepsilon (x - a)}{3(b - a)} \\
        \implies & \exists\ N_2 \in \mathbf{Z}^+ : \forall\ n \geq N_2, \forall\ x \in [a, b],                                                     \\
                 & \frac{-\varepsilon (x - a)}{3(b - a)} \leq f_n(x) - f_n(a) - \int_{[a, x]} g(x) \leq \frac{\varepsilon (x - a)}{3(b - a)}       \\
        \implies & \exists\ N_2 \in \mathbf{Z}^+ : \forall\ n \geq N_2, \forall\ x \in [a, b],                                                     \\
                 & \abs*{f_n(x) - f_n(a) - \int_{[a, x]} g(x)} \leq \frac{\varepsilon \abs*{x - a}}{3(b - a)}.
    \end{align*}
    Let \(N = \max(N_1, N_2)\).
    Then we have
    \begin{align*}
         & \forall\ n \geq N, \forall\ x \in [a, b], \abs*{f_n(x) - f(x)}                                                           \\
         & = \abs*{f_n(x) - f_n(x_0) + f_n(x_0) - f_n(a) + f_n(a) - L + \int_{[a, x_0]} g - \int_{[a, x]} g}                        \\
         & \leq \abs*{f_n(x) - f_n(a) - \int_{[a, x]} g} + \abs*{f_n(x_0) - L} + \abs*{f_n(x_0) - f_n(a) - \int_{[a, x_0]} g}       \\
         & < \frac{\varepsilon \abs*{x - a}}{3(b - a)} + \frac{\varepsilon \abs*{x_0 - a}}{3(b - a)} + \frac{\varepsilon}{3(b - a)} \\
         & < \frac{\varepsilon}{3} + \frac{\varepsilon}{3} + \frac{\varepsilon}{3} = \varepsilon.
    \end{align*}
    Since \(\varepsilon\) is arbitrary, we have
    \[
        \forall\ \varepsilon \in \mathbf{R}^+, \exists\ N \in \mathbf{Z}^+ : \forall\ n \geq N, \forall\ x \in [a, b], \abs*{f_n(x) - f(x)} < \varepsilon
    \]
    and by Definition \ref{3.2.7} \((f_n)_{n = 1}^\infty\) converges uniformly to \(f\) with respect to \(d_{l^1}|_{\mathbf{R} \times \mathbf{R}}\).

    Since \(f_n\) is continuous on \([a, b]\) for each \(n \in \mathbf{Z}^+\), by Corollary \ref{3.3.2} we know that \(f\) is also continuous on \([a, b]\).
    Since \(g\) is continuous on \([a, b]\), by fundamental theorem of calculus (Theorem 11.9.1 in Analysis) we know that
    \[
        \forall\ x \in X, G(x) = \int_{[a, x]} g \text{ is differentiable at } x.
    \]
    Since \(L + \int_{[a, x_0]} g\) is constant, we know that
    \[
        \forall\ x \in X, f(x) = L + \int_{[a, x_0]} g + G(x) = L + \int_{[a, x_0]} g + \int_{[a, x]} g \text{ is differentiable at } x
    \]
    and by fundamental theorem of calculus (Theorem 11.9.1 in Analysis) we have
    \[
        \forall\ x \in X, f'(x) = \bigg(\int_{[a, x]} g\bigg)' = g(x).
    \]
\end{proof}

\begin{note}
    Informally, Theorem \ref{3.7.1} says that if \(f_n'\) converges uniformly, and \(f_n(x_0)\) converges for some \(x_0\), then \(f_n\) also converges uniformly, and
    \[
        \frac{d}{dx} \lim_{n \to \infty} f_n(x) = \lim_{n \to \infty} \frac{d}{dx} f_n(x)
    \]
\end{note}

\begin{remark}\label{3.7.2}
    It turns out that Theorem \ref{3.7.1} is still true when the functions \(f_n'\) are not assumed to be continuous, but the proof is more difficult;
    see Exercise \ref{ex 3.7.2}.
\end{remark}

\begin{corollary}\label{3.7.3}
    Let \([a, b]\) be an interval, and for every integer \(n \geq 1\), let \(f_n : [a, b] \to \mathbf{R}\) be a differentiable function whose derivative \(f_n' : [a, b] \to \mathbf{R}\) is continuous.
    Suppose that the series \(\sum_{n = 1}^\infty \norm*{f_n'}_\infty\) is absolutely convergent, where
    \[
        \norm*{f_n'}_\infty \coloneqq \sup_{x \in [a, b]} \abs*{f_n'(x)}
    \]
    is the sup norm of \(f_n'\), as defined in Definition \ref{3.5.5}.
    Suppose also that the series \(\sum_{n = 1}^\infty f_n(x_0)\) is convergent for some \(x_0 \in [a, b]\).
    Then the series \(\sum_{n = 1}^\infty f_n\) converges uniformly on \([a, b]\) to a differentiable function, and in fact
    \[
        \frac{d}{dx} \sum_{n = 1}^\infty f_n(x) = \sum_{n = 1}^\infty \frac{d}{dx} f_n(x)
    \]
    for all \(x \in [a, b]\).
\end{corollary}

\exercisesection

\begin{exercise}\label{ex 3.7.1}
    Complete the proof of Theorem \ref{3.7.1}.
    Compare this theorem with Example 1.2.10 in Analysis I, and explain why this example does not contradict the theorem.
\end{exercise}

\begin{exercise}\label{ex 3.7.2}
    Prove Theorem \ref{3.7.1} without assuming that \(f_n'\) is continuous.
    (This means that you cannot use the fundamental theorem of calculus.
    However, the mean value theorem (Corollary 10.2.9 in Analysis I) is still available.
    Use this to show that if \(d_\infty(f_n', f_m') \leq \varepsilon\), then \(\abs*{\big(f_n(x) - f_m(x)\big) - \big(f_n(x_0) - f_m(x_0)\big)} \leq \varepsilon \abs*{x - x_0}\) for all \(x \in [a, b]\), and then use this to complete the proof of Theorem \ref{3.7.1}.)
\end{exercise}

\begin{exercise}\label{ex 3.7.3}
    Prove Corollary \ref{3.7.3}.
\end{exercise}

\begin{proof}
    See Corollary \ref{3.7.3}.
\end{proof}